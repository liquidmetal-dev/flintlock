name: nightly_e2e

on: [pull_request]

jobs:
  e2e:
    name: e2e tests
    runs-on: ubuntu-latest
    env:
      METAL_AUTH_TOKEN: ${{ secrets.METAL_AUTH_TOKEN }}
    steps:
    - uses: actions/checkout@v2
    - uses: actions/setup-go@v2
      with:
        go-version: '^1.16.2'
    - uses: hashicorp/setup-terraform@v1
      with:
        terraform_version: 1.0.1
    - name: Run tests
      if: ${{ env.METAL_AUTH_TOKEN != '' }}
      run: make test-e2e
    # - name: Cleanup
    #   uses: weaveworks/metal-janitor-action@b0373b3a6a8bb1e6573616040121c22ba230cdc8
    #   with:
    #     metal-auth-token: ${{ secrets.METAL_AUTH_TOKEN }}
    #     project-names: 'team-quicksilver-liquidmetal'
